<html>
	<head>
		<title>Tree Generator</title>
		<style>canvas { width: 100%; height: 100% }</style>
	</head>
	<body>
		<script src="js/three.min.js"></script>
		<script src="js/OrbitControls.js"></script>
		<script src="js/procedural.js"></script>

		<script>
			var scene = new THREE.Scene();
			var camera = new THREE.PerspectiveCamera(60, window.innerWidth/window.innerHeight, 1, 1000);
			var renderer = new THREE.WebGLRenderer();

			function render() {
				controls.update();
				renderer.render(scene, camera);
			}

			function animate() {
				requestAnimationFrame(animate);
				render();
			}

			renderer.setSize(window.innerWidth, window.innerHeight);
			document.body.appendChild(renderer.domElement);

			camera.position.add(new THREE.Vector3(30, 10, 40));

			// LIGHTS
			hemiLight = new THREE.HemisphereLight( 0xffffff, 0xffffff, 0.6 );
			hemiLight.color.setHSL( 0.6, 1, 0.6 );
			hemiLight.groundColor.setHSL( 0.095, 1, 0.75 );
			hemiLight.position.set( 0, 500, 0 );
			scene.add( hemiLight );

			dirLight = new THREE.DirectionalLight( 0xffffff, 1 );
			dirLight.color.setHSL( 0.1, 1, 0.95 );
			dirLight.position.set( -1, 1.75, 1 );
			dirLight.position.multiplyScalar( 50 );
			scene.add( dirLight );

			dirLight.castShadow = true;

			dirLight.shadowMapWidth = 2048;
			dirLight.shadowMapHeight = 2048;

			var d = 50;

			dirLight.shadowCameraLeft = -d;
			dirLight.shadowCameraRight = d;
			dirLight.shadowCameraTop = d;
			dirLight.shadowCameraBottom = -d;

			dirLight.shadowCameraFar = 3500;
			dirLight.shadowBias = -0.0001;
			dirLight.shadowDarkness = 0.35;

			var derivation = PROCEDURAL.calculateLSystemDerivation(
				11,
				"FA",
			  {
					"A": [
						{"odds": "0.80", "successor": "^FB///B/////B"},
						{"odds": "0.10", "successor": "^FB\\\\B///B"},
						{"odds": "0.05", "successor": "^FB/B"},
						{"odds": "0.05", "successor": "^B"}
					],
					"B": [
					  {"odds": "0.75", "successor": "[^^F//////AL]"},
						{"odds": "0.25", "successor": "[^^&F\\\\\\AL]"}
					]
				}
			);

			for(var i = 0; i < 2; i++) {
				for (var j = 0; j < 2; j++) {
					var tree = PROCEDURAL.interpretLSystemDerivation(derivation, {
						'angle': 0.15*Math.PI,
						'length': 2,
						'depthSizeRatio': 0.95,
						'branchMaterial': new THREE.MeshPhongMaterial( { ambient: 0x565d5d, color: 0x965d5d, specular: 0x050505 } ),
						'leafMaterial': new THREE.MeshPhongMaterial( { ambient: 0xe8ffff, color: 0xe8ffff, specular: 0x050505 } ),
						'angleVariation': 0.30,
						'sizeVariation': 0.25
						});
					tree.position.y = -5;

					tree.position.x = i*30-15;
					tree.position.z = j*30-15;
					scene.add(tree);
				}
			}

			var groundGeometry = new THREE.BoxGeometry( 60, 10, 60 );
			var groundMaterial = new THREE.MeshPhongMaterial( { ambient: 0xe8e8ff, color: 0xe8e8ff, specular: 0x050505 } );
			var ground = new THREE.Mesh(groundGeometry, groundMaterial);
			ground.position.y = -10;
			scene.add(ground);

			controls = new THREE.OrbitControls(camera, renderer.domElement);
			controls.userPan = false;
			controls.userPanSpeed = 0.0;
			controls.maxDistance = 5000.0;
			controls.maxPolarAngle = Math.PI * 0.495;

			render();
			animate();
		</script>
	</body>
</html>
